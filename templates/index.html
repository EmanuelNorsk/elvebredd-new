<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>
    <script src="../static/js/index.js"></script>
    <link rel="stylesheet" href="https://use.typekit.net/uju1lhj.css">
</head>
<body style="background-color:rgb(253, 249, 234);">
    <header>
        {% include "header.html" %}
    </header>
    <div style="width:100vw;height:600rem;position:relative;" id="slides">
        <div class="slide">
            <div style="position:relative;width:100%;height:100%;">
                <div style="width:100vw;height:575rem;overflow:hidden;">
                    <img style="width:100%;height:100%;object-fit: cover;object-position: center;" src="../static/images/misc/image100.png">
                </div>
                <img style="position:absolute;height:400rem;width:auto;right:5%;top:15%;" src="../static/images/misc/image101.png">
                <div style="position:absolute;z-index:11;left:0%;top:0%;width:100vw;height:575rem;background:linear-gradient(180deg, rgb(0,0,0,0) 0%, rgb(253, 249, 234, 1) 100%)"></div>
                <div style="position:absolute;width:435rem;height:40%;background:none;left:3%;bottom:40%;z-index:20;display:flex;align-items:center;flex-direction:column;">
                    <p style="font-size:30.1rem;font-weight:bold;color:rgb(253, 249, 234);margin:0px;">USED BY</p>
                    <div style="display:flex;align-items:center;justify-content:center;height:100rem;">
                        <p style="font-size:120rem;font-weight:bold;color:rgb(253, 249, 234);margin:0px;padding-top:10rem;">1M+</p>
                    </div>
                    <p style="font-size:42.2rem;font-weight:200;color:rgb(253, 249, 234);margin:0px;">ADOPT ME TRADERS</p>
                    <div style="display:flex;flex-direction:row;gap:10rem;align-items:center;margin-top:45rem;margin-left:10rem;">
                        <div style="width:2rem;height:40rem;background-color:rgb(253, 249, 234);margin-left:10rem;"></div>
                        <p style="font-size:19rem;font-weight:normal;color:rgb(253, 249, 234);margin:0px;">Use the same Adopt Me Values as the best traders in the world</p>
                    </div>
                    <div style="width:100%;padding-top:21rem;margin-left:30rem;">
                        <a href="/value-calculator">
                            <button class="frontMenuButton">
                                <p>Value calculator</p>
                            </button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="slide">
            <div style="position:relative;width:100%;height:100%;">
                <div style="width:100vw;height:575rem;overflow:hidden;">
                    <img style="width:100%;height:100%;object-fit: cover;object-position: center;" src="../static/images/misc/image100.png">
                </div>
                <img style="position:absolute;height:400rem;width:auto;right:5%;top:15%;" src="../static/images/misc/image101.png">
                <div style="position:absolute;z-index:11;left:0%;top:0%;width:100vw;height:575rem;background:linear-gradient(180deg, rgb(0,0,0,0) 0%, rgb(253, 249, 234, 1) 100%)"></div>
                <div style="position:absolute;width:435rem;height:40%;background:none;left:30%;bottom:40%;z-index:20;display:flex;align-items:center;flex-direction:column;">
                    <p style="font-size:30.1rem;font-weight:bold;color:rgb(253, 249, 234);margin:0px;">USED BY</p>
                    <div style="display:flex;align-items:center;justify-content:center;height:100rem;">
                        <p style="font-size:120rem;font-weight:bold;color:rgb(253, 249, 234);margin:0px;padding-top:10rem;">1M+</p>
                    </div>
                    <p style="font-size:42.2rem;font-weight:200;color:rgb(253, 249, 234);margin:0px;">ADOPT ME TRADERS</p>
                    <div style="display:flex;flex-direction:row;gap:10rem;align-items:center;margin-top:45rem;margin-left:10rem;">
                        <div style="width:2rem;height:40rem;background-color:rgb(253, 249, 234);margin-left:10rem;"></div>
                        <p style="font-size:19rem;font-weight:normal;color:rgb(253, 249, 234);margin:0px;">Use the same Adopt Me Values as the best traders in the world</p>
                    </div>
                    <div style="width:100%;padding-top:21rem;margin-left:30rem;">
                        <a href="/value-calculator">
                            <button class="frontMenuButton">
                                <p>Value calculator</p>
                            </button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="position:absolute;width:100vw;height:550rem;top:0%;left:0%;display:flex;flex-direction:column-reverse;align-items:center;">
        <div id="slidesInfo">

        </div>
    </div>

    <main class="maxWidth main" style="display:flex;flex-direction:column;justify-content:center;overflow:hidden;">
        <div style="width:100%;padding-right:10%;">
            <p style="font-size:22rem;font-weight:bold;font-family:'Aileron', sans-serif;margin:0px;padding:10rem;" class="listingsTitles">Suggested</p>
        </div>
        <div id="listingsCategory1" class="listings">

        </div>
        <div style="width:100%">
            <p style="font-size:22rem;font-weight:bold;font-family:'Aileron', sans-serif;margin:0px;margin-top:2.5vw;padding:10rem;" class="listingsTitles">Recent</p>
        </div>
        <div id="listingsCategory2" class="listings">

        </div>
        <div style="width:100%">
            <p style="font-size:22rem;font-weight:bold;font-family:'Aileron', sans-serif;margin:0px;margin-top:2.5vw;padding:10rem;" class="listingsTitles">Overpay</p>
        </div>
        <div id="listingsCategory3" class="listings">

        </div>
    </main>

    <div id="addInventory">
        <div style="display:flex;flex-direction:row;justify-content:space-between;padding-right:5%;padding-left:5%;">
            <div class="center" style="gap:max(0.25vw, 0.5vh);padding:max(0.5vw, 1vh);">
                <img id="filterImage" src="../static/images/misc/menu.png">
                <p id="filterText">Filter</p>
            </div>
            <div id="petSearchDiv" class="center">
                <input id="petSearch" placeholder="Search" onkeyup="searchUpPets()">
                <img id="petSearchImage" src="../static/images/misc/search.png">
            </div>
        </div>
        <div style="display:flex;flex-direction:row;justify-content:space-between;gap:0.5vw">
            <div id="filter">
                <div id="filterButtons">
                    <button id="all" class="filterButton" onclick="filter('all', 0)"><b class="filterButtonText">All</b></button>
                    <button id="pets" class="filterButton" onclick="filter('pets', 0)"><b class="filterButtonText">Pets</b></button>
                    <button id="common" class="filterButton" onclick="filter('common', 0)"><b class="filterButtonText">Common</b></button>
                    <button id="eggs" class="filterButton" onclick="filter('eggs', 0)"><b class="filterButtonText">Eggs</b></button>
                    <button id="legendary" class="filterButton" onclick="filter('legendary', 0)"><b class="filterButtonText">Legendary</b></button>
                    <button id="other" class="filterButton" onclick="filter('other', 0)"><b class="filterButtonText">Other</b></button>
                    <button id="petWear" class="filterButton" onclick="filter('pet wear', 0)"><b class="filterButtonText">Pet Wear</b></button>
                    <button id="rare" class="filterButton" onclick="filter('rare', 0)"><b class="filterButtonText">Rare</b></button>
                    <button id="ultraRare" class="filterButton" onclick="filter('ultra rare', 0)"><b class="filterButtonText">Ultra-Rare</b></button>
                    <button id="uncommon" class="filterButton" onclick="filter('uncommon', 0)"><b class="filterButtonText">Uncommon</b></button>
                    <button id="vehicles" class="filterButton" onclick="filter('vehicles', 0)"><b class="filterButtonText">Vehicles</b></button>
                </div>
            </div>
            <div class="center">
                <div id="petImages">

                </div>
            </div>
        </div>
        <div id="imageButtons">
            <button id="flyButton" onclick="enableFly()">
                <h1 style="color:white;">F</h1>
            </button>
            <button id="rideButton" onclick="enableRide()">
                <h1 style="color:white;">R</h1>
            </button>
            <button id="regularButton" onclick="enableRegular()">
                <h1 style="color:white;">D</h1>
            </button>
            <button id="neonButton" onclick="enableNeon()">
                <h1 style="color:white;">N</h1>
            </button>
            <button id="megaButton" onclick="enableMega()">
                <h1 style="color:white;">M</h1>
            </button>
        </div>
        <div id="closeButton" onclick="closeInventory()">
            <img style="width:max(1.5vw, 3vh);aspect-ratio: 1/1;" src="../static/images/misc/close.svg">
        </div>
    </div>
    <div id="listingInterface2">
        <div id="listingInterface2Upper">
            <div style="padding:max(2vw, 4vh);display:flex;flex-direction:row;justify-content:space-between;height:100%;">
                <div style="display:flex;flex-direction:column;gap:4px;">
                    <b class="listingInterface2TextBig">Your Offer</b>
                    <button id="modifyYourOffer" class="l2button" onclick="modifyYourOffer()">Modify Your Offer</button>
                </div>
                <div style="display:flex;flex-direction:column;gap:4px;">
                    <b class="listingInterface2TextBig red">Their Offer</b>
                    <button id="modifyTheirOffer" class="l2button" onclick="modifyTheirOffer()">Modify Their Offer</button>
                </div>
            </div>
        </div>
        <div id="listingInterface2Lower">
            <div id="listingPart1Div">
                <div id="listingPart1">

                </div>
                <b id="listingCloseButton" onclick="closeListingInterface2()">Close</b>
            </div>
            <div style="height:100%;width:1px;background-color:black;position:relative;">
                <b id="listingValue">0</b>
            </div>
            <div id="listingPart2Div">
                <div id="listingPart2">

                </div>
                <b id="listingAcceptButton">Accept</b>
                <b id="listingCustomOfferButton">Send Custom Offer</b>
                <div id="ownerInfo">
                    <b>Listing made by:</b>
                    <b id="owner"></b>
                </div>
            </div>
        </div>
    </div>
    <div>

    </div>
    <div onclick="closeListingInterface2()" id="listingInterface2Background">
        &nbsp;
    </div>
    <div onclick="closeInventory()" id="addInventoryBackground">
        &nbsp;
    </div>
    <div id="errorDiv">
        <b id="errorText"></b>
    </div>
    <div id="messageDiv">
        <b id="messageText"></b>
    </div>
    <div id="leftArrow" onclick="scrollBackward()">
        <img src="/static/images/misc/arrow.png">
    </div>
    <div id="rightArrow" onclick="scrollForward()">
        <img src="/static/images/misc/arrow.png">
    </div>
    <footer>
        {% include "footer.html" %}
    </footer>
</body>
</html>

<script type="application/data" id="tradesDict">
    {{ trades | tojson | safe }}
</script>

<script type="application/data" id="petsDict-data">
    {{ pets | tojson | safe }}
</script>

<script type="application/data" id="userDataDict-data">
    {{ userData | tojson | safe }}
</script>

<script>
    var autoScroll = 0

    var tradesDictElement = document.getElementById("tradesDict")
    var trades = JSON.parse(tradesDict.textContent)

    var petsDictElement = document.getElementById("petsDict-data")
    var petsDict = JSON.parse(petsDictElement.textContent)

    var listingsCategory1 = document.getElementById("listingsCategory1")
    var listingsCategory2 = document.getElementById("listingsCategory2")
    var listingsCategory3 = document.getElementById("listingsCategory3")

    var calculateWithValue = "shark"

    var addPetToType = ""

    var displayPetsFirstTime = 0

    var petSearch = document.getElementById("petSearch")
    var lastFilter = "all"

    var errorDiv = document.getElementById("errorDiv")
    var errorText = document.getElementById("errorText")

    var addInventory = document.getElementById("addInventory")
    var addInventoryBackground = document.getElementById("addInventoryBackground")

    var filterElement = document.getElementById("filter")
    var petImages = document.getElementById("petImages")
    var filterButtons = document.getElementById("filterButtons")

    var petImage = document.querySelectorAll(".petImage")

    var flyButton = document.getElementById("flyButton")
    var rideButton = document.getElementById("rideButton")
    var regularButton = document.getElementById("regularButton")
    var neonButton = document.getElementById("neonButton")
    var megaButton = document.getElementById("megaButton")

    var messageDiv = document.getElementById("messageDiv")
    var messageText = document.getElementById("messageText")

    var fly = 0
    var ride = 0
    var regular = 1
    var neon = 0
    var mega = 0

    var all = document.getElementById("all")
    var pets = document.getElementById("pets")
    var common = document.getElementById("common")
    var eggs = document.getElementById("eggs")
    var legendary = document.getElementById("legendary")
    var other = document.getElementById("other")
    var petWear = document.getElementById("petWear")
    var rare = document.getElementById("rare")
    var ultraRare = document.getElementById("ultraRare")
    var uncommon = document.getElementById("uncommon")
    var vehicles = document.getElementById("vehicles")

    var petSearch = document.getElementById("petSearch")
    var lastFilter = "all"

    var addInventory = document.getElementById("addInventory")
    var addInventoryBackground = document.getElementById("addInventoryBackground")

    var filterElement = document.getElementById("filter")
    var petImages = document.getElementById("petImages")
    var filterButtons = document.getElementById("filterButtons")

    var petAdded = document.getElementById("petAdded")
    var petAddedText = document.getElementById("petAddedText")

    var petsAdded = 0

    var listingInterface2 = document.getElementById("listingInterface2")
    var listingInterface2Background = document.getElementById("listingInterface2Background")

    var listingPart1 = document.getElementById("listingPart1")
    var listingPart2 = document.getElementById("listingPart2")

    var owner = document.getElementById("owner")

    var listingValue = document.getElementById("listingValue")

    var modifyTheirOfferElement = document.getElementById("modifyTheirOffer")
    var modifyYourOfferElement = document.getElementById("modifyYourOffer")

    var mYO = 0
    var mTO = 0

    var slideClass = document.querySelectorAll(".slide")

    var slides = document.getElementById("slides")
    var slidesInfo = document.getElementById("slidesInfo")
    var slideOn = Math.floor(Math.random() * slides.children.length)
    if (slideOn == slides.children.length && slideOn !== 0) {
        slideOn -= 1
    }

    var currentListing = 0

    var listingAcceptButton = document.getElementById("listingAcceptButton")
    var listingCustomOfferButton = document.getElementById("listingCustomOfferButton")

    var offerAccepted = false

    var lastUsedKey = "-1"

    var listingPart1Dict = {}
    var listingPart2Dict = {}

    var scrollSpeed = 3
    var selectedCategory = 0
    var listings = document.querySelectorAll(".listings")

    var mouseX = 0
    var mouseY = 0

    var leftArrow = document.getElementById("leftArrow")
    var rightArrow = document.getElementById("rightArrow")

    var listingsTitles = document.querySelectorAll(".listingsTitles")
    var listingSize = 310

    function setAddPetTypeTo(type) {
        addPetType = type
    }

    setTimeout(event => {
        for (let i = 0; i < slides.children.length; i++) {
            slides.children[i].style.transition = "1s ease";
        }
    }, 100)

    function createListingPetDivWithKey(data, key, counter2, tradePart) {
        const petDiv = document.createElement("div")
        petDiv.className = "petDiv"
        const img = document.createElement("img")
        img.src = petsDict[data[key]["offer"][tradePart][counter2.toString()]["id"]]["image"]
        img.style.maxWidth = "25px"
        img.style.maxHeight = "25px"
        petDiv.appendChild(img)

        const attributeDiv = document.createElement("div")
        attributeDiv.className = "attributeDiv"

        if (data[key]["offer"][tradePart][counter2.toString()]["fly"] == "1") {
            const flyDiv = document.createElement("div")
            flyDiv.className = "listingPetAttribute"
            flyDiv.style.background = "linear-gradient(135deg, rgb(142, 202, 232) 0%, rgb(47, 152, 204) 50%, rgb(0, 134, 200) 100%)"
            const txt1 = document.createElement("b")
            txt1.innerText = "F"
            flyDiv.appendChild(txt1)
            attributeDiv.appendChild(flyDiv)
        }

        if (data[key]["offer"][tradePart][counter2.toString()]["ride"] == "1") {
            const rideDiv = document.createElement("div")
            rideDiv.className = "listingPetAttribute"
            rideDiv.style.background = "linear-gradient(135deg, rgb(255, 197, 220) 0%, rgb(237, 44, 121) 50%, rgb(255, 0, 101) 100%)"
            const txt2 = document.createElement("b")
            txt2.innerText = "R"
            rideDiv.appendChild(txt2)
            attributeDiv.appendChild(rideDiv)
        }

        if (data[key]["offer"][tradePart][counter2.toString()]["neon"] == "1") {
            const neonDiv = document.createElement("div")
            neonDiv.className = "listingPetAttribute"
            neonDiv.style.background = "linear-gradient(135deg, rgb(193, 255, 110) 0%, rgb(140, 198, 63) 50%, rgb(19, 114, 11) 100%)"
            const txt3 = document.createElement("b")
            txt3.innerText = "N"
            neonDiv.appendChild(txt3)
            attributeDiv.appendChild(neonDiv)
        }

        if (data[key]["offer"][tradePart][counter2.toString()]["mega"] == "1") {
            const megaDiv = document.createElement("div")
            megaDiv.className = "listingPetAttribute"
            megaDiv.style.background = "linear-gradient(135deg, rgb(187, 80, 253) 0%, rgb(69, 3, 198) 50%, rgb(81, 28, 182) 100%)"
            const txt4 = document.createElement("b")
            txt4.innerText = "M"
            megaDiv.appendChild(txt4)
            attributeDiv.appendChild(megaDiv)
        }

        petDiv.appendChild(attributeDiv)

        return petDiv
    }

    function acceptOfferWithKey(key) {
        if (offerAccepted == false) {
            formData = new FormData();
            formData.append('key', key)
            formData.append('action', "acceptOfferWithKey");

            fetch('/api', {
            method: 'POST',
            body: formData
            })
            .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
            })
            .then(data => {
            if (data == "SUCCESS") {
                displayMessage("You accepted the offer!")
                closeListingInterface2()
            } else {
                displayError(data)
            }
            })
            .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
            });  
        }
    }

    function sendCustomOfferWithKey() {
        formData = new FormData();
        formData.append('trade1', JSON.stringify(listingPart1Dict))
        formData.append('trade2', JSON.stringify(listingPart2Dict))
        formData.append('user', currentListing["owner"])
        formData.append('action', "sendCustomOffer");

        fetch('/api', {
        method: 'POST',
        body: formData
        })
        .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
        })
        .then(data => {
        if (data == "SUCCESS") {
            displayMessage("You sent a custom offer!")
            closeListingInterface2()
        } else {
            displayError(data)
        }
        })
        .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
        }); 
    }

    function displayMessage(message) {
        messageDiv.style.bottom = "10%"
        messageText.innerText = message
        setTimeout((event) => {
            messageDiv.style.bottom = "-100%"
        }, 2000)
    }

    function showUserListings(listings, target) {
        target.innerHTML = ""
        target.setAttribute("scroll", "0")
        target.setAttribute("firstScroll", "1")
        var id = 0
        Object.keys(listings).forEach(key => {
            const div = document.createElement("div")
            div.className = "userListingsListing"
            div.setAttribute("id", id)

            div.setAttribute("data-key", key)

            const div2 = document.createElement("div")
            div2.className = "userListingUpper"

            const div5 = document.createElement("div")
            div5.className = "userListingLine"

            const txt1 = document.createElement("b")
            txt1.innerText = "Your Offer"
            txt1.style.color = "red"

            const txt2 = document.createElement("b")
            var text = calculateTradeValueWithInput(listings[key]["offer"]["give"], listings[key]["offer"]["take"])
            if (parseFloat(text) <= 0) {
                txt2.style.color = "black"
                text = (Math.abs(parseFloat(text))).toString()
            } else {
                txt2.style.color = "red"
                div5.style.backgroundColor = "red"
            }
            if (text.length > 3) {
                txt2.style.fontSize = (32 / (text.length / 3)).toString() + "px"
            } else {
                txt2.style.fontSize = "32px"
            }
            txt2.innerText = text
            txt2.className = "userListingValue"

            const txt3 = document.createElement("b")
            txt3.innerText = "Their Offer"

            div2.appendChild(txt1)
            div2.appendChild(txt2)
            div2.appendChild(txt3)

            const div3 = document.createElement("div")
            div3.className = "listingInfo"

            const div4 = document.createElement("div")

            div4.className = "Grid3x3Listing"

            var counter = 0
        
            while (counter < 9) {
                if (listings[key]["offer"]["give"][counter] == undefined) {
                    const petDiv = document.createElement("div")
                    petDiv.className = "petDiv"
                    div4.appendChild(petDiv)
                } else {
                    if (counter == 8 && listings[key]["offer"]["give"].length > 9) {
                        const petDiv = document.createElement("div")
                        petDiv.className = "petDiv"
                        const txt4 = document.createElement("b")
                        txt4.innerText = "+" + (listings[key]["offer"]["give"].length - 8).toString()
                        txt4.style.fontSize = "16px"
                        petDiv.appendChild(txt4)
                        div4.appendChild(petDiv)
                    } else {
                        const petDiv = document.createElement("div")
                        petDiv.className = "petDiv"
                        const img = document.createElement("img")
                        img.src = petsDict[listings[key]["offer"]["give"][counter]["id"]]["image"]
                        petDiv.appendChild(img)

                        const attributeDiv = document.createElement("div")
                        attributeDiv.className = "attributeDiv"

                        if (listings[key]["offer"]["give"][counter]["fly"] == "1") {
                            const flyDiv = document.createElement("div")
                            flyDiv.className = "listingPetAttribute flyDiv"
                            const txt1 = document.createElement("b")
                            txt1.innerText = "F"
                            flyDiv.appendChild(txt1)
                            attributeDiv.appendChild(flyDiv)
                        }

                        if (listings[key]["offer"]["give"][counter]["ride"] == "1") {
                            const rideDiv = document.createElement("div")
                            rideDiv.className = "listingPetAttribute rideDiv"
                            const txt2 = document.createElement("b")
                            txt2.innerText = "R"
                            rideDiv.appendChild(txt2)
                            attributeDiv.appendChild(rideDiv)
                        }

                        if (listings[key]["offer"]["give"][counter]["neon"] == "1") {
                            const neonDiv = document.createElement("div")
                            neonDiv.className = "listingPetAttribute neonDiv"
                            const txt3 = document.createElement("b")
                            txt3.innerText = "N"
                            neonDiv.appendChild(txt3)
                            attributeDiv.appendChild(neonDiv)
                        }

                        if (listings[key]["offer"]["give"][counter]["mega"] == "1") {
                            const megaDiv = document.createElement("div")
                            megaDiv.className = "listingPetAttribute"
                            const txt4 = document.createElement("b")
                            txt4.innerText = "M"
                            megaDiv.appendChild(txt4)
                            attributeDiv.appendChild(megaDiv)
                        }

                        petDiv.appendChild(attributeDiv)
                        div4.appendChild(petDiv)
                    }
                }
                counter += 1
            }

            const div6 = document.createElement("div")
            div6.className = "Grid3x3Listing"

            counter = 0

            while (counter < 9) {
                if (listings[key]["offer"]["take"][counter] == undefined) {
                    const petDiv = document.createElement("div")
                    petDiv.className = "petDiv"
                    div6.appendChild(petDiv)
                } else {
                    if (counter == 8 && listings[key]["offer"]["take"].length > 9) {
                        const petDiv = document.createElement("div")
                        petDiv.className = "petDiv"
                        const txt4 = document.createElement("b")
                        txt4.innerText = "+" + (listings[key]["offer"]["take"].length - 8).toString()
                        txt4.style.fontSize = "16px"
                        petDiv.appendChild(txt4)
                        div6.appendChild(petDiv)
                    } else {
                        const petDiv = document.createElement("div")
                        petDiv.className = "petDiv"
                        const img = document.createElement("img")
                        img.src = petsDict[listings[key]["offer"]["take"][counter]["id"]]["image"]
                        petDiv.appendChild(img)

                        const attributeDiv = document.createElement("div")
                        attributeDiv.className = "attributeDiv"

                        if (listings[key]["offer"]["take"][counter]["fly"] == "1") {
                            const flyDiv = document.createElement("div")
                            flyDiv.className = "listingPetAttribute flyDiv"
                            const txt1 = document.createElement("b")
                            txt1.innerText = "F"
                            flyDiv.appendChild(txt1)
                            attributeDiv.appendChild(flyDiv)
                        }

                        if (listings[key]["offer"]["take"][counter]["ride"] == "1") {
                            const rideDiv = document.createElement("div")
                            rideDiv.className = "listingPetAttribute rideDiv"
                            const txt2 = document.createElement("b")
                            txt2.innerText = "R"
                            rideDiv.appendChild(txt2)
                            attributeDiv.appendChild(rideDiv)
                        }

                        if (listings[key]["offer"]["take"][counter]["neon"] == "1") {
                            const neonDiv = document.createElement("div")
                            neonDiv.className = "listingPetAttribute neonDiv"
                            const txt3 = document.createElement("b")
                            txt3.innerText = "N"
                            neonDiv.appendChild(txt3)
                            attributeDiv.appendChild(neonDiv)
                        }

                        if (listings[key]["offer"]["take"][counter]["mega"] == "1") {
                            const megaDiv = document.createElement("div")
                            megaDiv.className = "listingPetAttribute"
                            const txt4 = document.createElement("b")
                            txt4.innerText = "M"
                            megaDiv.appendChild(tx4t4)
                            attributeDiv.appendChild(megaDiv)
                        }

                        petDiv.appendChild(attributeDiv)
                        div6.appendChild(petDiv)
                    }
                }
                counter += 1
            }

            div3.appendChild(div4)
            div3.appendChild(div5)
            div3.appendChild(div6)

            div.appendChild(div2)
            div.appendChild(div3)
            if ( loggedIn == "True" ) {
                div.setAttribute("onclick", "openListingInterface2(" + JSON.stringify(listings) + ", " + key.toString() + "); updateViewsWithKey('" + key.toString() + "')");
            }
            target.appendChild(div)
            id += 1
        })

        updateUserListings(target, true)
    }

    function scrollBackward() {
        var scroll = parseInt(selectedCategory.getAttribute("scroll"))
        scroll -= scrollSpeed
        selectedCategory.setAttribute("scroll", scroll.toString())
        updateUserListings(selectedCategory, false)
    }

    function scrollForward() {
        var scroll = parseInt(selectedCategory.getAttribute("scroll"))
        scroll += scrollSpeed
        selectedCategory.setAttribute("scroll", scroll.toString())
        selectedCategory.setAttribute("firstScroll", "0")
        updateUserListings(selectedCategory, false)
    }

    function isMouseOverElement(element) {
        const rect = element.getBoundingClientRect();
        return (
            mouseX >= rect.left &&
            mouseX <= rect.right &&
            mouseY >= rect.top &&
            mouseY <= rect.bottom
        );
    }

    document.addEventListener("mousemove", event => {
        var hover = 0
        mouseX = event.clientX
        mouseY = event.clientY
        listings.forEach(element => {
            if (isMouseOverElement(element)) {
                selectedCategory = element
                hover = 1
                updateArrows()
            }
        })
        if (hover == 0) {
            leftArrow.style.display = "none"
            rightArrow.style.display = "none"
        }
    })

    document.addEventListener("scroll", event => {
        var hover = 0
        listings.forEach(element => {
            if (isMouseOverElement(element)) {
                selectedCategory = element
                hover = 1
                updateArrows()
            }
        })
        if (hover == 0) {
            leftArrow.style.display = "none"
            rightArrow.style.display = "none"
        }
    })

    window.addEventListener("resize", (event) => {
        var hover = 0
        listings.forEach(element => {
            updateUserListings(element, true)
            if (isMouseOverElement(element)) {
                selectedCategory = element
                hover = 1
                updateArrows()
            }
        })
        if (hover == 0) {
            leftArrow.style.display = "none"
            rightArrow.style.display = "none"
        }
        slideClass.forEach(element => {
            element.style.transition = "none"
            void element.offsetWidth
            element.style.transition = "1s ease"
        })
    })



    function updateArrows() {
        const rect = selectedCategory.getBoundingClientRect()
        leftArrow.style.left = (rect.x + parseInt(selectedCategory.getAttribute("scrollOffset"))).toString() + "px"
        leftArrow.style.top = (rect.y + 105).toString() + "px"
        rightArrow.style.left = (rect.width - parseInt(selectedCategory.getAttribute("scrollOffset"))).toString() + "px"
        rightArrow.style.top = (rect.y + 105).toString() + "px"
        rightArrow.style.paddingLeft = (listingSize / 2 - ((listingSize / 2) - selectedCategory.getAttribute("scrollOffset")) / 2).toString() + "px"
        leftArrow.style.paddingRight = (listingSize / 2 - ((listingSize / 2) - selectedCategory.getAttribute("scrollOffset")) / 2).toString() + "px"
        leftArrow.style.display = "flex"
        rightArrow.style.display = "flex"
        if (selectedCategory.getAttribute("firstScroll") == "1") {
            leftArrow.style.display = "none"
        }
    }


    function updateUserListings(listings, resize) {
        var scroll = parseInt(listings.getAttribute("scroll"))
        var fitFor = parseInt((window.innerWidth - 100) / listingSize)
        scrollSpeed = fitFor
        var offset = ((fitFor / 2) - 0.5)
        var id = 0
        var listingOffset = 0
        var left = 0
        var right = 0
        var posX = 0
        var firstScroll = parseInt(listings.getAttribute("firstScroll"))
        Array.from(listings.children).forEach(listing => {
            id = parseInt(listing.getAttribute("id"))
            left1 = (listingSize * (id - (scroll % listings.children.length) - offset))
            left2 = (listingSize * (id - (scroll % listings.children.length) - (listings.children.length - 1) - offset))
            left3 = (listingSize * (id - (scroll % listings.children.length) + (listings.children.length - 1) - offset))
            leftOffset = Math.min(Math.abs(left1), Math.abs(left2), Math.abs(left3))
            if (Math.abs(left1) == leftOffset) {
                left = left1
            } else if (Math.abs(left2) == leftOffset) {
                left = left2
            } else {
                left = left3
            }

            right1 = (listingSize * ((id - (listings.children.length - 1)) - (scroll % listings.children.length) - offset))
            right2 = (listingSize * ((id - (listings.children.length - 1)) - (scroll % listings.children.length) - (listings.children.length - 1) - offset))
            right3 = (listingSize * ((id - (listings.children.length - 1)) - (scroll % listings.children.length) + (listings.children.length - 1) - offset))
            rightOffset = Math.min(Math.abs(right1), Math.abs(right2), Math.abs(right3))
            if (Math.abs(right1) == rightOffset) {
                right = right1
            } else if (Math.abs(right2) == rightOffset) {
                right = right2
            } else {
                right = right3
            }
        

            listingOffset = Math.min(Math.abs(left), Math.abs(right))
            if (listingOffset == Math.abs(left)) {
                listingOffset = left
            } else {
                listingOffset = right
            }
            posX = ((listings.offsetWidth / 2) + listingOffset).toString()
            if ((Math.abs(listing.getBoundingClientRect().left - posX) > window.innerWidth) || resize == true) {
                listing.style.transition = "none"
            } else {
                listing.style.transition = "1s ease"
            }
            listing.style.left = posX + "px"
            if ((listingSize / 2) < posX && posX < window.innerWidth - (listingSize / 2)) {
                listing.style.opacity = "1"
                listing.style.filter = "brightness(100%)"
                listing.style.cursor = "normal"
            } else {
                listing.style.opacity = "0.5"
                listing.style.filter = "brightness(50%)"
                listing.style.cursor = "pointer"
                if (firstScroll == 1 && posX < window.innerWidth - (listingSize / 2)) {
                    listing.style.opacity = "0"
                }
            }
            if (id == (scroll % listings.children.length)) {
                listings.setAttribute("scrollOffset", ((listings.offsetWidth / 2) + listingOffset - listingSize).toString())
                listingsTitles.forEach(element => {
                    element.style.marginLeft = (listingSize / 2 + ((listings.offsetWidth / 2) + listingOffset - listingSize)).toString() + "px"
                })
            }

        })

    }

    function calculateTradeValueWithInput(trade1, trade2) {
        var totalValue = 0
        var value = ""
        var trade1Value = 0
        var trade2Value = 0
        for (const i in trade1) {
            value = ""
            if (trade1[i].regular == "1") {
                value += "rvalue"
            } else if (trade1[i].neon == "1") {
                value += "nvalue"
            } else {
                value += "mvalue"
            }
            if (trade1[i].fly == "1" && trade1[i].ride == "1") {
                value += " - fly&ride"
            } else if (trade1[i].fly == "1") {
                value += " - fly"
            } else if (trade1[i].ride == "1") {
                value += " - ride"
            }
            trade1Value += petsDict[trade1[i].id][value]
        }
        for (const i in trade2) {
            value = ""
            if (trade2[i].regular == "1") {
                value += "rvalue"
            } else if (trade2[i].neon == "1") {
                value += "nvalue"
            } else {
                value += "mvalue"
            }
            if (trade2[i].fly == "1" && trade2[i].ride == "1") {
                value += " - fly&ride"
            } else if (trade2[i].fly == "1") {
                value += " - fly"
            } else if (trade2[i].ride == "1") {
                value += " - ride"
            }
            trade2Value += petsDict[trade2[i].id][value]
        }

        const oldTrade1Value = trade1Value
        const oldTrade2Value = trade2Value

        if (calculateWithValue == "frost") {
            trade1Value /= 105
            trade2Value /= 105
        }

        trade1Value = trade1Value.toFixed(2)
        trade2Value = trade2Value.toFixed(2)

        if (oldTrade1Value > 0 && trade1Value == 0) {
            trade1Value = 0.01
        }
        if (oldTrade2Value > 0 && trade2Value == 0) {
            trade2Value = 0.01
        }

        const finalValue = (trade1Value - trade2Value).toFixed(2)

        return finalValue
    }

    function modifyYourOffer() {
        if ( mYO == 0) {
            mYO = 1
            modifyYourOfferElement.style.border = "1px solid white"
            showUserListings2(currentListing, "left")
        } else {
            mYO = 0
            modifyYourOfferElement.style.border = "1px solid black"
            showUserListings2(currentListing, "left")
        }
    }

    function modifyTheirOffer() {
        if ( mTO == 0) {
            mTO = 1
            modifyTheirOfferElement.style.border = "1px solid white"
            showUserListings2(currentListing, "right")
        } else {
            mTO = 0
            modifyTheirOfferElement.style.border = "1px solid black"
            showUserListings2(currentListing, "right")
        }
    }

    function openListingInterface2(listing, key) {
        listingInterface2Background.style.display = "block"
        listingInterface2.style.display = "flex"
        lastUsedKey = key
        showUserListings2(listing[key], 0)
    }

    function closeListingInterface2() {
        listingInterface2Background.style.display = "none"
        listingInterface2.style.display = "none"
    }

    function showUserListings2(listing, modified) {
        currentListing = listing
        if (modified == 0) {
            listingPart1Dict = JSON.parse(JSON.stringify(currentListing["offer"]["give"]))
            listingPart2Dict = JSON.parse(JSON.stringify(currentListing["offer"]["take"]))
        } else if (modified == "left") {
            listingPart1Dict = JSON.parse(JSON.stringify(currentListing["offer"]["give"]))
        } else if (modified == "right") {
            listingPart2Dict = JSON.parse(JSON.stringify(currentListing["offer"]["take"]))
        }

        listingPart1.innerHTML = ""
        listingPart2.innerHTML = ""
        owner.innerText = currentListing["ownerUsername"]

        var gridSize = 0
        if ( mYO == 1 ) {
            gridSize = Math.ceil(Math.sqrt(listingPart1Dict.length + 1))
        } else {
            gridSize = Math.ceil(Math.sqrt(listingPart1Dict.length))
        }
        listingPart1.style.gridTemplateColumns = "repeat(" + (gridSize).toString() + ", 1fr)"
        for (const i in listingPart1Dict) {
            const div = document.createElement("div")
            div.style.width = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.style.height = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.style.display = "flex"
            div.style.justifyContent = "center"
            div.style.alignItems = "center"
            div.style.position = "relative"
            const img = document.createElement("img")
            img.src = petsDict[listingPart1Dict[i]["id"]]["image"]
            img.style.width = "90%"
            img.style.height = "90%"
            img.style.minWidth = "max(" + (12 / gridSize).toString() + "vw, " + (24 / gridSize).toString() + "vh)"
            img.style.minHeight = "max(" + (12 / gridSize).toString() + "vw, " + (24 / gridSize).toString() + "vh)"
            img.style.maxWidth = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            img.style.maxHeight = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.appendChild(img)

            if ( mYO == 1) {
                div.setAttribute("onclick", "removePetFromInventory('listing1', " + i.toString() + ")")
            }

            const attributeDiv = document.createElement("div")
            attributeDiv.style.position = "absolute"
            attributeDiv.style.left = "max(" + (2 / gridSize).toString() + "vw, " + (4 / gridSize).toString() + "vh)"
            attributeDiv.style.bottom = "max(" + (2 / gridSize).toString() + "vw, " + (4 / gridSize).toString() + "vh)"
            attributeDiv.style.display = "flex"
            attributeDiv.style.flexDirection = "row"
            attributeDiv.style.gap = "max(" + (0.5 / gridSize).toString() + "vw, " + (1 / gridSize).toString() + "vh)"

            var attribute = ""
            var attributeText = ""
            if (listingPart1Dict[i]["fly"] == "1") {
                attribute = document.createElement("div")
                attribute.style.width = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.height = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.background = "linear-gradient(135deg, rgb(142, 202, 232) 0%, rgb(47, 152, 204) 50%, rgb(0, 134, 200) 100%)"
                attribute.style.borderRadius = "max(" + (1 / gridSize).toString() + "vw, " + (2 / gridSize).toString() + "vh)"
                attribute.style.display = "flex"
                attribute.style.alignItems = "center"
                attribute.style.justifyContent = "center"
                attributeText = document.createElement("b")
                attributeText.style.color = "white"
                attributeText.innerText = "F"
                attributeText.style.fontSize = "max(" + (1.5 / gridSize).toString() + "vw, " + (3 / gridSize).toString() + "vh)"

                attribute.appendChild(attributeText)
                attributeDiv.appendChild(attribute)
            }

            if (listingPart1Dict[i]["ride"] == "1") {
                attribute = document.createElement("div")
                attribute.style.width = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.height = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.background = "linear-gradient(135deg, rgb(255, 197, 220) 0%, rgb(237, 44, 121) 50%, rgb(255, 0, 101) 100%)"
                attribute.style.borderRadius = "max(" + (1 / gridSize).toString() + "vw, " + (2 / gridSize).toString() + "vh)"
                attribute.style.display = "flex"
                attribute.style.alignItems = "center"
                attribute.style.justifyContent = "center"
                attributeText = document.createElement("b")
                attributeText.style.color = "white"
                attributeText.innerText = "R"
                attributeText.style.fontSize = "max(" + (1.5 / gridSize).toString() + "vw, " + (3 / gridSize).toString() + "vh)"

                attribute.appendChild(attributeText)
                attributeDiv.appendChild(attribute)
            }

            if (listingPart1Dict[i]["neon"] == "1") {
                attribute = document.createElement("div")
                attribute.style.width = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.height = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.background = "linear-gradient(135deg, rgb(193, 255, 110) 0%, rgb(140, 198, 63) 50%, rgb(19, 114, 11) 100%)"
                attribute.style.borderRadius = "max(" + (1 / gridSize).toString() + "vw, " + (2 / gridSize).toString() + "vh)"
                attribute.style.display = "flex"
                attribute.style.alignItems = "center"
                attribute.style.justifyContent = "center"
                attributeText = document.createElement("b")
                attributeText.style.color = "white"
                attributeText.innerText = "N"
                attributeText.style.fontSize = "max(" + (1.5 / gridSize).toString() + "vw, " + (3 / gridSize).toString() + "vh)"

                attribute.appendChild(attributeText)
                attributeDiv.appendChild(attribute)
            }

            if (listingPart1Dict[i]["mega"] == "1") {
                attribute = document.createElement("div")
                attribute.style.width = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.height = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.background = "linear-gradient(135deg, rgb(187, 80, 253) 0%, rgb(69, 3, 198) 50%, rgb(81, 28, 182) 100%)"
                attribute.style.borderRadius = "max(" + (1 / gridSize).toString() + "vw, " + (2 / gridSize).toString() + "vh)"
                attribute.style.display = "flex"
                attribute.style.alignItems = "center"
                attribute.style.justifyContent = "center"
                attributeText = document.createElement("b")
                attributeText.style.color = "white"
                attributeText.innerText = "M"
                attributeText.style.fontSize = "max(" + (1.5 / gridSize).toString() + "vw, " + (3 / gridSize).toString() + "vh)"

                attribute.appendChild(attributeText)
                attributeDiv.appendChild(attribute)
            }



            div.appendChild(attributeDiv)
            listingPart1.appendChild(div)
        }

        if ( mYO == 1 ) {
            const div = document.createElement("div")
            div.style.width = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.style.height = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.style.display = "flex"
            div.style.justifyContent = "center"
            div.style.alignItems = "center"
            div.style.position = "relative"
            const img = document.createElement("img")
            img.src = "../static/images/misc/add.png"
            img.style.width = "90%"
            img.style.height = "90%"
            img.style.minWidth = "max(" + (12 / gridSize).toString() + "vw, " + (24 / gridSize).toString() + "vh)"
            img.style.minHeight = "max(" + (12 / gridSize).toString() + "vw, " + (24 / gridSize).toString() + "vh)"
            img.style.maxWidth = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            img.style.maxHeight = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.appendChild(img)
            div.setAttribute("onclick", "setAddPetTypeTo('listing1'); openInventory()")
            listingPart1.appendChild(div)
        }

        if ( mTO == 1 ) {
            gridSize = Math.ceil(Math.sqrt(listingPart2Dict.length + 1))
        } else {
            gridSize = Math.ceil(Math.sqrt(listingPart2Dict.length))
        }
        listingPart2.style.gridTemplateColumns = "repeat(" + (gridSize).toString() + ", 1fr)"
        for (const j in listingPart2Dict) {
            const div = document.createElement("div")
            div.style.width = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.style.height = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.style.display = "flex"
            div.style.justifyContent = "center"
            div.style.alignItems = "center"
            div.style.position = "relative"
            const img = document.createElement("img")
            img.src = petsDict[listingPart2Dict[j]["id"]]["image"]
            img.style.width = "90%"
            img.style.height = "90%"
            img.style.minWidth = "max(" + (12 / gridSize).toString() + "vw, " + (24 / gridSize).toString() + "vh)"
            img.style.minHeight = "max(" + (12 / gridSize).toString() + "vw, " + (24 / gridSize).toString() + "vh)"
            img.style.maxWidth = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            img.style.maxHeight = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.appendChild(img)

            if ( mTO == 1) {
                div.setAttribute("onclick", "removePetFromInventory('listing2', " + j.toString() + ")")
            }

            const attributeDiv = document.createElement("div")
            attributeDiv.style.position = "absolute"
            attributeDiv.style.left = "max(" + (2 / gridSize).toString() + "vw, " + (4 / gridSize).toString() + "vh)"
            attributeDiv.style.bottom = "max(" + (2 / gridSize).toString() + "vw, " + (4 / gridSize).toString() + "vh)"
            attributeDiv.style.display = "flex"
            attributeDiv.style.flexDirection = "row"
            attributeDiv.style.gap = "max(" + (0.5 / gridSize).toString() + "vw, " + (1 / gridSize).toString() + "vh)"

            var attribute = ""
            var attributeText = ""
            if (listingPart2Dict[j]["fly"] == "1") {
                attribute = document.createElement("div")
                attribute.style.width = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.height = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.background = "linear-gradient(135deg, rgb(142, 202, 232) 0%, rgb(47, 152, 204) 50%, rgb(0, 134, 200) 100%)"
                attribute.style.borderRadius = "max(" + (1 / gridSize).toString() + "vw, " + (2 / gridSize).toString() + "vh)"
                attribute.style.display = "flex"
                attribute.style.alignItems = "center"
                attribute.style.justifyContent = "center"
                attributeText = document.createElement("b")
                attributeText.style.color = "white"
                attributeText.innerText = "F"
                attributeText.style.fontSize = "max(" + (1.5 / gridSize).toString() + "vw, " + (3 / gridSize).toString() + "vh)"

                attribute.appendChild(attributeText)
                attributeDiv.appendChild(attribute)
            }

            if (listingPart2Dict[j]["ride"] == "1") {
                attribute = document.createElement("div")
                attribute.style.width = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.height = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.background = "linear-gradient(135deg, rgb(255, 197, 220) 0%, rgb(237, 44, 121) 50%, rgb(255, 0, 101) 100%)"
                attribute.style.borderRadius = "max(" + (1 / gridSize).toString() + "vw, " + (2 / gridSize).toString() + "vh)"
                attribute.style.display = "flex"
                attribute.style.alignItems = "center"
                attribute.style.justifyContent = "center"
                attributeText = document.createElement("b")
                attributeText.style.color = "white"
                attributeText.innerText = "R"
                attributeText.style.fontSize = "max(" + (1.5 / gridSize).toString() + "vw, " + (3 / gridSize).toString() + "vh)"

                attribute.appendChild(attributeText)
                attributeDiv.appendChild(attribute)
            }

            if (listingPart2Dict[j]["neon"] == "1") {
                attribute = document.createElement("div")
                attribute.style.width = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.height = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.background = "linear-gradient(135deg, rgb(193, 255, 110) 0%, rgb(140, 198, 63) 50%, rgb(19, 114, 11) 100%)"
                attribute.style.borderRadius = "max(" + (1 / gridSize).toString() + "vw, " + (2 / gridSize).toString() + "vh)"
                attribute.style.display = "flex"
                attribute.style.alignItems = "center"
                attribute.style.justifyContent = "center"
                attributeText = document.createElement("b")
                attributeText.style.color = "white"
                attributeText.innerText = "N"
                attributeText.style.fontSize = "max(" + (1.5 / gridSize).toString() + "vw, " + (3 / gridSize).toString() + "vh)"

                attribute.appendChild(attributeText)
                attributeDiv.appendChild(attribute)
            }

            if (listingPart2Dict[j]["mega"] == "1") {
                attribute = document.createElement("div")
                attribute.style.width = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.height = "max(" + (3 / gridSize).toString() + "vw, " + (6 / gridSize).toString() + "vh)"
                attribute.style.background = "linear-gradient(135deg, rgb(187, 80, 253) 0%, rgb(69, 3, 198) 50%, rgb(81, 28, 182) 100%)"
                attribute.style.borderRadius = "max(" + (1 / gridSize).toString() + "vw, " + (2 / gridSize).toString() + "vh)"
                attribute.style.display = "flex"
                attribute.style.alignItems = "center"
                attribute.style.justifyContent = "center"
                attributeText = document.createElement("b")
                attributeText.style.color = "white"
                attributeText.innerText = "M"
                attributeText.style.fontSize = "max(" + (1.5 / gridSize).toString() + "vw, " + (3 / gridSize).toString() + "vh)"

                attribute.appendChild(attributeText)
                attributeDiv.appendChild(attribute)
            }



            div.appendChild(attributeDiv)
            listingPart2.appendChild(div)
        }

        if ( mTO == 1 ) {
            const div = document.createElement("div")
            div.style.width = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.style.height = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.style.display = "flex"
            div.style.justifyContent = "center"
            div.style.alignItems = "center"
            div.style.position = "relative"
            const img = document.createElement("img")
            img.src = "../static/images/misc/add.png"
            img.style.width = "90%"
            img.style.height = "90%"
            img.style.minWidth = "max(" + (12 / gridSize).toString() + "vw, " + (24 / gridSize).toString() + "vh)"
            img.style.minHeight = "max(" + (12 / gridSize).toString() + "vw, " + (24 / gridSize).toString() + "vh)"
            img.style.maxWidth = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            img.style.maxHeight = "max(" + (15 / gridSize).toString() + "vw, " + (30 / gridSize).toString() + "vh)"
            div.appendChild(img)
            div.setAttribute("onclick", "setAddPetTypeTo('listing2'); openInventory()")
            listingPart2.appendChild(div)
        }

        var original = true

        if (currentListing["offer"]["give"].length !== listingPart1Dict.length) {
            original = false
        }

        if (currentListing["offer"]["take"].length !== listingPart2Dict.length) {
            original = false
        }

        for (const i in currentListing["offer"]["give"]) {
            if (currentListing["offer"]["give"][i]["id"] !== listingPart1Dict[i]["id"]) {
                original = false
            }
            if (currentListing["offer"]["give"][i]["fly"] !== listingPart1Dict[i]["fly"]) {
                original = false
            }
            if (currentListing["offer"]["give"][i]["ride"] !== listingPart1Dict[i]["ride"]) {
                original = false
            }
            if (currentListing["offer"]["give"][i]["regular"] !== listingPart1Dict[i]["regular"]) {
                original = false
            }
            if (currentListing["offer"]["give"][i]["neon"] !== listingPart1Dict[i]["neon"]) {
                original = false
            }
            if (currentListing["offer"]["give"][i]["mega"] !== listingPart1Dict[i]["mega"]) {
                original = false
            }
        }

        for (const j in currentListing["offer"]["take"]) {
            if (currentListing["offer"]["take"][j]["id"] !== listingPart2Dict[j]["id"]) {
                original = false
            }
            if (currentListing["offer"]["take"][j]["fly"] !== listingPart2Dict[j]["fly"]) {
                original = false
            }
            if (currentListing["offer"]["take"][j]["ride"] !== listingPart2Dict[j]["ride"]) {
                original = false
            }
            if (currentListing["offer"]["take"][j]["regular"] !== listingPart2Dict[j]["regular"]) {
                original = false
            }
            if (currentListing["offer"]["take"][j]["neon"] !== listingPart2Dict[j]["neon"]) {
                original = false
            }
            if (currentListing["offer"]["take"][j]["mega"] !== listingPart2Dict[j]["mega"]) {
                original = false
            }
        }

        if (currentListing["ownerRobloxUsername"] == "") {
            listingAcceptButton.setAttribute("onclick","giveImportantMessage('Accept Trade', 'Are you sure you want to accept this trade? They are responsible for contacting you to complete the trade through roblox. They do not have a linked roblox username, so be aware of that in your inbox on roblox.', 'closeListingInterface2()', 'acceptOfferWithKey(" + lastUsedKey.toString() + ")')")
            listingCustomOfferButton.setAttribute("onclick","giveImportantMessage('Send Custom Trade', 'Are you sure you want to send a custom offer? They will receive this offer in their inbox. You are both responsible for contacting eachother to complete the trade through roblox. Their roblox username is " + currentListing["ownerRobloxUsername"] + ".', 'closeListingInterface2()', 'sendCustomOfferWithKey(" + lastUsedKey.toString() + ")')")
        } else {
            listingAcceptButton.setAttribute("onclick","giveImportantMessage('Accept Trade', 'Are you sure you want to accept this trade? You are responsible for contacting the other party to complete the trade after this through roblox. Their username in roblox is " + currentListing["ownerRobloxUsername"] + ".', 'closeListingInterface2()', 'acceptOfferWithKey(" + lastUsedKey.toString() + ")')")
            listingCustomOfferButton.setAttribute("onclick","giveImportantMessage('Send Custom Trade', 'Are you sure you want to send a custom offer? They will receive this offer in their inbox. They are responsible for contacting you to complete the trade through roblox. They do not have a linked roblox username, so be aware of that in your inbox on roblox.', 'closeListingInterface2()', 'sendCustomOfferWithKey(" + lastUsedKey.toString() + ")')")
        }



        if (original == true) {
            listingAcceptButton.style.opacity = 1
            listingAcceptButton.style.bottom = "max(1vw, 2vh)"
            listingCustomOfferButton.style.opacity = 0
            listingCustomOfferButton.style.bottom = "-1000%"
        } else {
            listingAcceptButton.style.opacity = 0
            listingAcceptButton.style.bottom = "-1000%"
            listingCustomOfferButton.style.opacity = 1
            listingCustomOfferButton.style.bottom = "max(1vw, 2vh)"
        }

        if (listing["acceptedBy"] !== null) {
            listingAcceptButton.style.cursor = "default"
            listingAcceptButton.innerText = "Offer already accepted"
            listingAcceptButton.style.width = "max(10vw, 20vh)"
            listingAcceptButton.disabled = true
            listingAcceptButton.setAttribute("onclick", "")
            offerAccepted = true
        } else {
            listingAcceptButton.style.cursor = "pointer"
            listingAcceptButton.innerText = "Accept"
            listingAcceptButton.style.width = "max(5vw, 10vh)"
            offerAccepted = false
        }



        var txt = calculateTradeValueWithInput(listingPart1Dict, listingPart2Dict)

        if (txt >= 0) {
            listingValue.style.color = "red"
        } else {
            listingValue.style.color = "black"
            txt = (Math.abs(parseInt(txt))).toString()
        }
        listingValue.innerText = txt
    }

    function displayPets() {
        if (loggedIn == "True" && displayPetsFirstTime == 0) {
            displayPetsFirstTime = 1
            petImages.innerHTML = ""
            Object.keys(petsDict).forEach(key => {
                pet = petsDict[key]
                if (pet["image"] !== "") {
                    const div = document.createElement("div")
                    div.className = "petImage"
                    div.setAttribute("data-petname", pet["name"])
                    div.setAttribute("data-name", pet["type"])
                    div.setAttribute("data-value", pet["rarity"])
                    div.setAttribute("onclick", "addPetToInventory(" + key.toString() + ")")
                    const img = document.createElement("img")
                    img.style.height = "max(3.5vw, 7vh)"
                    img.style.aspectRatio = "1/1"
                    img.setAttribute("onerror", "handleImageError(this)")
                    img.src = pet["image"]
                    div.appendChild(img)
                    petImages.appendChild(div)
                }
            })
        }
    }

    function openInventory() {
        displayPets()
        addInventory.style.display = "block"
        addInventoryBackground.style.display = "block"
        petImages.style.height = filterButtons.clientHeight + "px";
    }

    function closeInventory() {
        addInventory.style.display = "none"
        addInventoryBackground.style.display = "none"
    }

    function handleImageError(image) {
        image.style.display = 'none';
    }

    function addPetToInventory(pet) {
       if (addPetType == "listing1") {
            listingPart1Dict.push({
                "id":pet,
                "fly":fly,
                "ride":ride,
                "regular":regular,
                "neon":neon,
                "mega":mega
            })
            showUserListings2(currentListing, 1)
        } else if (addPetType == "listing2") {
            listingPart2Dict.push({
                "id":pet,
                "fly":fly,
                "ride":ride,
                "regular":regular,
                "neon":neon,
                "mega":mega
            })
            showUserListings2(currentListing, 1)
        }
    };

    function removePetFromInventory(type, pet) {
        if (type == "listing1") {
            listingPart1Dict.splice(pet, 1)
            showUserListings2(currentListing, 1)
        } else if (type == "listing2") {
            listingPart2Dict.splice(pet, 1)
            showUserListings2(currentListing, 1)
        }
    }

    function updateViewsWithKey(key) {
        formData = new FormData();
        formData.append('key', key)
        formData.append('action', "updateViewsOnTradeWithKey");

        fetch('/api', {
        method: 'POST',
        body: formData
        })
        .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
        })
        .then(data => {
        if (data == "SUCCESS") {
            
        }
        })
        .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
        });
    }

    function displayError(error) {
        errorDiv.style.bottom = "10%"
        errorText.innerText = error
        setTimeout((event) => {
            errorDiv.style.bottom = "-100%"
        }, 2000)
    }

    function filter(filter, preventLoop) {
        lastFilter = filter
        if (filter == "all") {
            petImage.forEach(pet => {
                pet.style.display = "flex";
            });
            resetFilterButtonBrightness()
            all.style.filter = "brightness(1.2)"
        } else if (filter == "pets") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-name") == "pets") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            pets.style.filter = "brightness(1.2)"
        } else if (filter == "common") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-value") == "common") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            common.style.filter = "brightness(1.2)"
        } else if (filter == "eggs") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-name") == "eggs") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            eggs.style.filter = "brightness(1.2)"
        } else if (filter == "legendary") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-value") == "legendary") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            legendary.style.filter = "brightness(1.2)"
        } else if (filter == "other") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-name") == "other") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            other.style.filter = "brightness(1.2)"
        } else if (filter == "pet wear") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-value") == "") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            petWear.style.filter = "brightness(1.2)"
        } else if (filter == "rare") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-value") == "rare") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            rare.style.filter = "brightness(1.2)"
        } else if (filter == "ultra rare") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-value") == "ultra rare") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            ultraRare.style.filter = "brightness(1.2)"
        } else if (filter == "uncommon") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-value") == "uncommon") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            uncommon.style.filter = "brightness(1.2)"
        } else if (filter == "vehicles") {
            petImage.forEach(pet => {
                if (pet.getAttribute("data-name") == "vehicles") {
                    pet.style.display = "flex";
                } else {
                    pet.style.display = "none";
                    filteredPets += 1
                }
            });
            resetFilterButtonBrightness()
            vehicles.style.filter = "brightness(1.2)"
        }
        if (preventLoop == 0) {
            searchUpPets()
        }
    }

    function searchUpPets() {
        filteredPets = 0
        filter(lastFilter, 1)
        petImage = document.querySelectorAll(".petImage")
        var length = 0
        petImage.forEach(pet => {
            if (pet.getAttribute("data-petname").toLowerCase().includes(petSearch.value) == false && pet.getAttribute("data-name").toLowerCase().includes(petSearch.value) == false && pet.getAttribute("data-value").toLowerCase().includes(petSearch.value) == false) {
                pet.style.display = "none"
            } else {
                length += 1
            };
        });
    };

    function resetFilterButtonBrightness() {
        all.style.filter = "brightness(1)"
        pets.style.filter = "brightness(1)"
        common.style.filter = "brightness(1)"
        eggs.style.filter = "brightness(1)"
        legendary.style.filter = "brightness(1)"
        other.style.filter = "brightness(1)"
        petWear.style.filter = "brightness(1)"
        rare.style.filter = "brightness(1)"
        ultraRare.style.filter = "brightness(1)"
        uncommon.style.filter = "brightness(1)"
        vehicles.style.filter = "brightness(1)"
    }

    function updateSlides() {
        slidesInfo.innerHTML = "";
        for (let i = 0; i < slides.children.length; i++) {
            const div = document.createElement("div");
            div.style.width = "7rem";
            div.style.height = "7rem";
            div.style.borderRadius = "100%";
            if (i == slideOn) {
                slides.children[i].style.opacity = "1";
                div.style.backgroundColor = "rgb(255, 102, 102)";
            } else {
                slides.children[i].style.opacity = "0";
                div.style.backgroundColor = "rgb(109, 107, 112)";
            }
            div.style.zIndex = "12";
            div.setAttribute("onclick", "changeToSlide(" + i.toString() + ")");
            div.style.cursor = "pointer";
            slidesInfo.appendChild(div);
        }
        autoScroll += 1
        const scroll = autoScroll
        setTimeout(event => {
            if (autoScroll == scroll) {
                slideOn += 1
                if (slideOn + 1 > slides.children.length) {
                    slideOn = 0
                }
                updateSlides()
            }
        }, 10000)
        
        
    }
    
    updateSlides()

    function changeToSlide(number) {
        slideOn = number
        updateSlides()
    }


    showUserListings(trades["Suggested"], listingsCategory1)
    showUserListings(trades["Recent"], listingsCategory2)
    showUserListings(trades["Overpay"], listingsCategory3)


</script>